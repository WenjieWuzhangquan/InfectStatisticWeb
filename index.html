<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>疫情地图</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="echarts.min.js"></script>
    <script src="china.js"></script>
    <script src="jquery-1.12.4.min.js"></script>
  </head>
  <body>
    <!-- 地图的位置 -->
    <div class="layui-main" id="map" style="width: 800px; height:600px;">
        地图
    </div>
    <!-- 手风琴的位置 -->
    <div class="layui-main layui-nav layui-bg-green">
      <div class="layui-container" style="height:30px;line-height:30px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            地区
          </div>
          <div class="layui-col-md2">
            疑似
          </div>
          <div class="layui-col-md2">
            确诊
          </div>
          <div class="layui-col-md2">
            治愈
          </div>
          <div class="layui-col-md2">
            死亡
          </div>
        </div>
      </div>

    <script type="layui/layui.js">
    </script>
    <script type="text/javascript">
    $.get("http://api.tianapi.com/txapi/ncovcity/index?key=5d4fb67d8bd16c1fd371311e334a4bd0",
        function (data, status) {
          var arr = [];
          // 处理数据，成地图需要的数据结构
          data.newslist.forEach(item => {
              arr.push({
                  name: item.provinceShortName,
                  value: item.confirmedCount,
                  zuixin: item.currentConfirmedCount,
                  zhiyu: item.curedCount,
                  siwang: item.deadCount
              });
          });
          arr.push({
              name: '南海诸岛',
              value: '未统计',
              zuixin: '未统计',
              zhiyu: '未统计',
              siwang: '未统计'
          });
          console.log(arr);

          var myChart = echarts.init(document.getElementById('map'));

          // 2. 配置
          var option = {
              // 标题部分
              title: {
                  text: '抗击疫情',
                  textStyle: {
                      fontSize: 28
                  },
                  left: 'center',
                  subtextStyle: {
                      fontSize: 14
                  }
              },
              series: [{
                  type: 'map',
                  map: 'china',
                  data: arr,
                  label: {
                      show: true
                  }
              }],
              tooltip: { // 鼠标悬浮提示
                  formatter: function (params) { // 允许我们自定义悬浮提示的内容
                      console.log(params);
                      // return 你需要提示的内容
                      return `累计确诊：${params.data.value}<br/>
                      当前确诊：${params.data.zuixin}<br/>
                      治愈：${params.data.zhiyu}<br/>
                      死亡：${params.data.siwang}<br/>
                      `;
                  }
              },
              visualMap: {
                  type: 'piecewise',
                  pieces: [
                      { gt: 10000 }, // 大于10000
                      { gt: 5000, lte: 10000 },
                      { gt: 1000, lte: 5000 },
                      { gt: 500, lte: 1000 },  // (900, 1500]
                      { gt: 100, lte: 500 },  // (310, 1000]
                      { gt: 10, lte: 100 },   // (200, 300]
                      { gt: 0, lte: 10 },       // (0, 10]
                  ],
                  inRange: {
                      color: ['#ffcfc3', '#eda595', '#d27b64', '#d5462a', '#a8352e', '#6a211d', '#562a2a']
                  }
              }
          };

        myChart.setOption(option);
        });
    </script>
  </body>
</html>
